@page "/Admin/ViewAllRequests"
@model Apartment.Pages.Admin.ViewAllRequestsModel
@{
    ViewData["Title"] = "All Tenant Requests";
    Layout = "_Layout";
}

<div class="d-flex matcha-shell">
    @await Html.PartialAsync("_AdminSidebar")

    <!-- Main Content -->
    <div class="main-content requests-main">
        <div class="container-fluid requests-container">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm requests-header">
                        <div class="card-body d-flex justify-content-between align-items-start flex-wrap gap-3">
                            <div>
                                <h2 class="requests-title mb-1">
                                    <i class="bi bi-person-workspace me-2"></i>Tenant Requests
                                </h2>
                                <p class="requests-subtitle mb-0">
                                    View all service and support tickets submitted by tenants.
                                </p>
                            </div>
                            <div class="requests-info-pill">
                                <i class="bi bi-info-circle me-2"></i>
                                <span>
                                    Track <strong>Submitted</strong>, <strong>In&nbsp;Progress</strong>, and <strong>Completed</strong> requests
                                    to keep tenants informed.
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Requests Table Card -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm requests-table-card">
                        <div class="card-header requests-table-header d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0 requests-table-title">
                                    <i class="bi bi-list-ul me-2"></i>All Requests
                                </h5>
                                <p class="requests-table-subtitle mb-0">
                                    @Model.Requests.Count request@(Model.Requests.Count == 1 ? "" : "s") across all units.
                                </p>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            @if (Model.Requests.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0 data-table requests-table">
                                        <thead class="requests-table-head">
                                            <tr>
                                                <th class="border-0 ps-4 requests-th">Title</th>
                                                <th class="border-0 requests-th">Tenant</th>
                                                <th class="border-0 requests-th">Unit</th>
                                                <th class="border-0 requests-th">Type</th>
                                                <th class="border-0 requests-th">Priority</th>
                                                <th class="border-0 requests-th">Status</th>
                                                <th class="border-0 requests-th">Date Submitted</th>
                                                <th class="border-0 requests-th text-center pe-4">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var request in Model.Requests)
                                            {
                                                <tr>
                                                    <td class="align-middle ps-4">
                                                        <div class="fw-semibold requests-title-cell">@request.Title</div>
                                                    </td>
                                                    <td class="align-middle">
                                                        <span class="requests-tenant">
                                                            @(request.SubmittedByUser?.Username ?? "N/A")
                                                        </span>
                                                    </td>
                                                    <td class="align-middle">
                                                        <span class="requests-unit">
                                                            @(request.Apartment?.UnitNumber ?? "N/A")
                                                        </span>
                                                    </td>
                                                    <td class="align-middle">
                                                        <span class="badge requests-badge-type">
                                                            @request.RequestType
                                                        </span>
                                                    </td>
                                                    <td class="align-middle">
                                                        <span class="badge requests-badge-priority @GetPriorityBadgeClass(request.Priority)">
                                                            @request.Priority
                                                        </span>
                                                    </td>
                                                    <td class="align-middle">
                                                        <span class="badge requests-badge-status @GetStatusBadgeClass(request.Status)">
                                                            @request.Status
                                                        </span>
                                                    </td>
                                                    <td class="align-middle">
                                                        <span class="requests-date">
                                                            @request.DateSubmitted.ToString("MMM dd, yyyy hh:mm tt")
                                                        </span>
                                                    </td>
                                                    <td class="align-middle text-center pe-4">
                                                        <a asp-page="/Admin/RequestDetails"
                                                           asp-route-id="@request.Id"
                                                           class="btn btn-teal btn-sm requests-view-btn"
                                                           title="View Details &amp; Reply">
                                                            <i class="bi bi-eye me-1"></i>View / Reply
                                                        </a>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="requests-empty-state text-center p-5">
                                    <div class="requests-empty-icon mb-3">
                                        <i class="bi bi-inbox"></i>
                                    </div>
                                    <h4 class="mb-2">No Tenant Requests Yet</h4>
                                    <p class="mb-0">
                                        Requests submitted by tenants will appear here for tracking and follow-up.
                                    </p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    public string GetStatusBadgeClass(Apartment.Enums.RequestStatus status)
    {
        return status switch
        {
            Apartment.Enums.RequestStatus.Submitted => "bg-primary",
            Apartment.Enums.RequestStatus.InProgress => "bg-warning text-dark",
            Apartment.Enums.RequestStatus.Completed => "bg-success",
            Apartment.Enums.RequestStatus.Cancelled => "bg-danger",
            _ => "bg-secondary"
        };
    }

    public string GetPriorityBadgeClass(Apartment.Enums.RequestPriority priority)
    {
        return priority switch
        {
            Apartment.Enums.RequestPriority.Low => "bg-info",
            Apartment.Enums.RequestPriority.Medium => "bg-warning text-dark",
            Apartment.Enums.RequestPriority.High => "bg-danger",
            _ => "bg-secondary"
        };
    }
}

<style>
    .matcha-shell {
        background: #F9F8F3;
    }

    .requests-main {
        margin-left: 280px;
        width: calc(100% - 280px);
        padding: 32px;
        min-height: 100vh;
        background: #F9F8F3;
        font-family: "Inter", "Nunito", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #2C2C2C;
    }

    .requests-container {
        max-width: 1240px;
    }

    .requests-header {
        border-radius: 16px;
        background: #FFFFFF;
        border: 1px solid #E7E5D8;
        border-top: 4px solid #D7A85A; /* Golden Whisk accent */
        box-shadow: 0 18px 35px rgba(139, 111, 71, 0.12);
    }

    .requests-title {
        font-family: "Cormorant Garamond", Georgia, serif;
        font-weight: 700;
        font-size: 30px;
        color: #4A6F47; /* Matcha Deep Green */
        letter-spacing: 0.03em;
    }

    .requests-subtitle {
        font-size: 0.95rem;
        color: #7B7B7B;
    }

    .requests-info-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.6rem 1rem;
        border-radius: 999px;
        background-color: #E5F2F2;
        color: #4A7A7A;
        font-size: 0.85rem;
    }

    .requests-info-pill i {
        font-size: 1rem;
    }

    /* Table styling */
    .requests-table-card {
        border-radius: 16px;
        overflow: hidden;
        background: #FFFFFF;
        border: 1px solid #E7E5D8;
        box-shadow: 0 18px 35px rgba(44, 44, 44, 0.06);
    }

    .requests-table-header {
        background: linear-gradient(135deg, #4A6F47 0%, #7DA26C 100%);
        color: #F9F8F3;
        padding: 1.1rem 1.5rem;
    }

    .requests-table-title {
        font-weight: 600;
        font-size: 1.05rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
    }

    .requests-table-subtitle {
        font-size: 0.85rem;
        opacity: 0.9;
    }

    .requests-table {
        border-collapse: separate;
        border-spacing: 0;
    }

    .requests-table-head {
        background-color: #F5F5F5;
        color: #000000;
    }

    .requests-th {
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #000000;
    }

    .requests-table tbody tr:nth-child(even) {
        background-color: #F9F8F3;
    }

    .requests-table tbody tr:nth-child(odd) {
        background-color: #FFFFFF;
    }

    .requests-table tbody tr:hover {
        background-color: #E3EDD9;
        transition: background-color 200ms ease-out;
    }

    .requests-table td {
        border-top: 1px solid #E7E5D8;
        padding: 0.9rem 0.75rem;
    }

    .requests-title-cell {
        color: #2C2C2C;
    }

    .requests-tenant,
    .requests-unit {
        color: #5F6368;
        font-size: 0.9rem;
    }

    .requests-date {
        color: #7B7B7B;
        font-size: 0.85rem;
    }

    /* Badges */
    .requests-badge-type {
        background-color: #E5F2F2;
        color: #336666;
        padding: 0.25rem 0.7rem;
        border-radius: 999px;
        font-weight: 500;
        font-size: 0.78rem;
    }

    .requests-badge-priority,
    .requests-badge-status {
        padding: 0.25rem 0.7rem;
        border-radius: 999px;
        font-weight: 500;
        font-size: 0.78rem;
    }

    .requests-view-btn {
        border-radius: 999px;
        padding-inline: 1.1rem;
        font-size: 0.8rem;
        font-weight: 500;
    }

    /* Empty state */
    .requests-empty-state {
        background-color: #F9F8F3;
    }

    .requests-empty-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background-color: #E7E5D8;
        color: #7B7B7B;
        font-size: 1.8rem;
    }

    /* DataTables length menu (Show entries) */
    .dataTables_length,
    .dataTables_length label {
        padding-left: 1rem;
    }

    .dataTables_length label {
        margin-bottom: 0;
    }
</style>
